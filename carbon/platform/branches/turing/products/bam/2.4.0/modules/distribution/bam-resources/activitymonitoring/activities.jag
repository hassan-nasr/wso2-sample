<html>
    <head>
        <title>Activities</title>
    </head>
</html>


<%
var caramel = require('caramel');

var isConnected  = session.get("isConnected");
if(isConnected == "true") {
    var query = session.get("query");
    if(query != null) {
        var carbon = require('carbon');
        var server = carbon.server;

        var log = new Log();
        var cluster  = session.get("cluster");
        try {
            var searchResults = String(server.osgiService('org.wso2.carbon.cassandra.search.service.CassandraSearchAdmin').
                    getActivitySearchResultsAsJson(cluster, query, 100));
            var activities = parse(searchResults);
        } catch (e) {
            log.error(e.lineNumber); // Error occured line number
            log.error(e.fileName); // Error occured script name
            log.error(e.stack); // Executed JavaScript file stack
            log.error(e.message); // JavaScript error message

            log.error(e.rhinoException); // Rhino exception object
            log.error(e.javaException); // Java excepton object

            log.error(e); // Logs the stack trace

            print(e); // prints the stack trace
        }

        caramel.render({
            activities: activities
        });
    } else {
        response.sendRedirect("search.jag");
    }

} else {
    response.sendRedirect("login.jag");
}


%>
